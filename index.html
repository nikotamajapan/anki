<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ•ãƒ©ãƒ³ã‚¹æ•°å­—ã‚¯ã‚¤ã‚º 11-99</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="game-container">
    <header class="header">
      <h1>ğŸ‡«ğŸ‡· ãƒ•ãƒ©ãƒ³ã‚¹æ•°å­—ã‚¯ã‚¤ã‚º 11-99</h1>
      <div class="score-board">
        <span class="score">ã‚¹ã‚³ã‚¢: <strong id="score">0</strong></span>
        <span class="level">å•é¡Œ: <strong id="questionNum">0</strong></span>
        <button type="button" class="sound-btn" id="soundBtn" title="éŸ³å£°ã®ã‚ªãƒ³/ã‚ªãƒ•">ğŸ”Š</button>
      </div>
    </header>

    <main class="main">
      <!-- å•é¡Œã‚¨ãƒªã‚¢: æ•°å­—ã‚’è¡¨ç¤º -->
      <section class="quiz-phase" id="quizPhase">
        <p class="quiz-label">ã“ã®ã™ã†ã˜ã®ãƒ•ãƒ©ãƒ³ã‚¹ã”ã¯ã©ã‚Œï¼Ÿ</p>
        <div class="quiz-word" id="quizWord"></div>
        <button type="button" class="replay-btn" id="replayBtn" title="éŸ³å£°ã‚’ã‚‚ã†ä¸€åº¦å†ç”Ÿ">ğŸ” ã‚‚ã†ä¸€åº¦èã</button>
        <div class="choices" id="choices">
          <button type="button" class="choice-btn" data-value=""></button>
          <button type="button" class="choice-btn" data-value=""></button>
          <button type="button" class="choice-btn" data-value=""></button>
          <button type="button" class="choice-btn" data-value=""></button>
        </div>
      </section>

      <!-- çµæœè¡¨ç¤º -->
      <div class="result-overlay hidden" id="resultOverlay">
        <div class="result-box">
          <p class="result-message" id="resultMessage"></p>
          <button type="button" class="next-btn" id="nextBtn">æ¬¡ã¸</button>
        </div>
      </div>

      <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ -->
      <div class="gameover-overlay hidden" id="gameoverOverlay">
        <div class="gameover-box">
          <h2>çµ‚äº†</h2>
          <p>æ­£è§£æ•°: <strong id="correctCount">0</strong> / <strong id="totalCount">0</strong></p>
          <button type="button" class="restart-btn" id="restartBtn">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
        </div>
      </div>
    </main>

    <footer class="footer">
      <button type="button" class="start-btn" id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <!-- æºå¸¯ã§éŠã¶: httpã§é–‹ã„ãŸã¨ãã ã‘è¡¨ç¤º -->
      <div class="mobile-link hidden" id="mobileLink">
        <p class="mobile-label">ğŸ“± æºå¸¯ã§éŠã¶</p>
        <p class="mobile-url" id="mobileUrl"></p>
        <img class="mobile-qr" id="mobileQr" alt="QRã‚³ãƒ¼ãƒ‰" />
        <p class="mobile-hint">åŒã˜Wi-Fiã®æºå¸¯ã§ã“ã®URLã‚’é–‹ãã‹ã€QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³</p>
      </div>
      <button type="button" class="mobile-toggle hidden" id="mobileToggle" title="æºå¸¯ç”¨URLã‚’è¡¨ç¤º">ğŸ“± URL</button>
    </footer>
  </div>
  <script src="script.js"></script>
  <script>
    (function() {
      var url = window.location.href;
      var isHttp = url.indexOf('http') === 0;
      var link = document.getElementById('mobileLink');
      var urlEl = document.getElementById('mobileUrl');
      var qrEl = document.getElementById('mobileQr');
      var toggle = document.getElementById('mobileToggle');
      function setUrl(u) {
        urlEl.textContent = u;
        qrEl.src = 'https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=' + encodeURIComponent(u);
      }
      if (isHttp && link && urlEl && qrEl) {
        setUrl(url);
        toggle.classList.remove('hidden');
        toggle.addEventListener('click', function() {
          link.classList.toggle('hidden');
        });
        if (url.indexOf('localhost') !== -1 || url.indexOf('127.0.0.1') !== -1) {
          var rtc = new (window.RTCPeerConnection || window.webkitRTCPeerConnection)({ iceServers: [] });
          rtc.createDataChannel('');
          rtc.createOffer().then(function(offer) { return rtc.setLocalDescription(offer); });
          rtc.onicecandidate = function(ev) {
            if (!ev || !ev.candidate || !ev.candidate.candidate) return;
            var m = ev.candidate.candidate.match(/([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})/);
            if (m && (m[1].startsWith('192.168.') || m[1].startsWith('10.') || m[1].startsWith('172.'))) {
              rtc.close();
              var port = window.location.port || '3000';
              var lanUrl = 'http://' + m[1] + ':' + port + window.location.pathname;
              setUrl(lanUrl);
            }
          };
        }
      } else if (toggle) {
        toggle.classList.add('hidden');
      }
    })();
  </script>
</body>
</html>
